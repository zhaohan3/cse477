/*! project3 2017-06-29 */

function Nurikabe(s,e,o){var t=this;this.sel=s,this.gameBoard=parse_json(e),this.gameSolution=parse_json(o),this.isRed=!1,this.consts={SEA:"sea",ISLAND:"island",VACANT:"vacant",RED:"red",RED_ISLAND:"red_island"},console.log("Game started!"),console.log(this.gameBoard),console.log(this.gameSolution),$("#winner-message").hide(),$("#solveYes").hide(),$("#solveNo").hide(),$("#message-solve").hide(),$(this.sel+" td button").click(function(s){s.preventDefault(),console.log("cell clicked!"),loc=this.value.split(","),r=loc[0],c=loc[1],t.updateCell(r,c,!1)}),$("#checkSolution").click(function(s){s.preventDefault(),console.log("check solution clicked!!"),t.checkSolution()}),$("#solve").click(function(s){s.preventDefault(),t.solveConfirm()}),$("#solveYes").click(function(s){s.preventDefault(),t.solveYes()}),$("#solveNo").click(function(s){s.preventDefault(),t.solveNo()}),$("#clear").click(function(){event.preventDefault(),console.log("clear clicked!!"),t.clear()})}function parse_json(s){try{var e=$.parseJSON(s)}catch(e){throw"JSON parse error: "+s}return e}Nurikabe.prototype.checkSolution=function(){for(var s=0;s<this.gameBoard.length;s++)for(var e=this.gameBoard[s],o=0;o<e.length;o++){var t=this.gameBoard[s][o],l=this.gameSolution[s][o];t!==this.consts.SEA&&t!==this.consts.ISLAND||t===l||(this.isRed=!0,this.updateCell(s,o,!0))}},Nurikabe.prototype.clear=function(){console.log("clear function called!!");for(var s=0;s<this.gameBoard.length;s++)for(var e=this.gameBoard[s],o=0;o<e.length;o++){var t=this.gameBoard[s][o];if(isNaN(t)){console.log("NaN found!!"),this.gameBoard[s][o]=this.consts.VACANT;var l=$(this.sel+" td#"+s+o),a=l.attr("class");console.log(a),l.removeClass(a),l.addClass("vacant"),l.children("button").html("&nbsp;")}}},Nurikabe.prototype.isSolved=function(){this.gameBoard.toString()===this.gameSolution.toString()&&(console.log("********** WINNER **********"),$("#checkSolution").hide(),$("#solve").hide(),$("#clear").hide(),$("#solveYes").hide(),$("#solveNo").hide(),$("#message-solve").hide(),$("#winner-message").show(),console.log($(this.sel+" td").children()),$(this.sel+" td").children().attr("disabled",!0),$(this.sel+" td").children().css("color","black"))},Nurikabe.prototype.solveConfirm=function(){console.log("solve confirm!!"),$("#checkSolution").hide(),$("#solve").hide(),$("#clear").hide(),$("#solveYes").show(),$("#solveNo").show(),$("#message-solve").show()},Nurikabe.prototype.solveNo=function(){console.log("Solve cuz i suck!!"),$("#solveYes").hide(),$("#solveNo").hide(),$("#message-solve").hide(),$("#checkSolution").show(),$("#solve").show(),$("#clear").show()},Nurikabe.prototype.solveYes=function(){console.log("solve me pls");for(var s=0;s<this.gameBoard.length;s++)for(var e=this.gameBoard[s],o=0;o<e.length;o++){this.gameBoard[s][o]=this.gameSolution[s][o];var t=$(this.sel+" td#"+s+o),l=t.attr("class");t.removeClass(l),this.gameSolution[s][o]===this.consts.SEA?(t.addClass("sea"),t.children("button").html("&nbsp;")):this.gameSolution[s][o]===this.consts.ISLAND&&(t.addClass("island"),t.children("button").html("&#9679;"))}this.isSolved()},Nurikabe.prototype.updateCell=function(s,e,o){console.log("update called!"),console.log(s+" "+e);var t=$(this.sel+" td#"+s+e);if(this.isRed&&!o){console.log("red cells present");for(var l=0;l<this.gameBoard.length;l++)for(var a=this.gameBoard[l],i=0;i<a.length;i++){var n=this.gameBoard[l][i],r=$(this.sel+" td#"+l+i);n===this.consts.RED?(r.removeClass("incorrect"),r.addClass("sea"),this.gameBoard[l][i]=this.consts.SEA):n===this.consts.RED_ISLAND&&(r.removeClass("incorrect"),r.addClass("island"),this.gameBoard[l][i]=this.consts.ISLAND)}this.isRed=!1}if("vacant"===t.attr("class"))t.removeClass("vacant"),t.addClass("sea"),this.gameBoard[s][e]=this.consts.SEA;else if("sea"===t.attr("class")){if(t.removeClass("sea"),o)return t.addClass("incorrect"),void(this.gameBoard[s][e]=this.consts.RED);t.addClass("island"),t.children("button").html("&#9679;"),this.gameBoard[s][e]=this.consts.ISLAND}else if("island"===t.attr("class")){if(t.removeClass("island"),o)return t.addClass("incorrect"),void(this.gameBoard[s][e]=this.consts.RED_ISLAND);t.addClass("vacant"),t.children("button").html("&nbsp;"),this.gameBoard[s][e]=this.consts.VACANT}this.isSolved()};