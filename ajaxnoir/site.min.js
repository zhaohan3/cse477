/*! ajaxnoir 2017-06-27 */

function Login(e){var t=$(e);t.submit(function(s){s.preventDefault(),console.log("Submitted"),$.ajax({url:"post/login.php",data:t.serialize(),method:"POST",success:function(t){var s=parse_json(t);console.log(s),s.ok?window.location.assign("./"):$(e+" .message").html("<p>"+s.message+"</p>")},error:function(t,s,o){console.log(o),$(e+" .message").html("<p>Error: "+o+"</p>")}})})}function MovieInfo(e,t,s){console.log("MovieInfo: "+t+"/"+s),this.sel=e;var o=this;$.ajax({url:"https://api.themoviedb.org/3/search/movie",data:{api_key:"7732627d0f99b9b50762bfd3a1f4869b",query:t,year:s},method:"GET",dataType:"text",success:function(e){console.log("success");var t=parse_json(e);if(0===t.total_results)console.log("nothing found"),$(o.sel).html("<p>No information available</p>");else{var s="";console.log(t),s+=o.info(t),s+=o.plot(t),null!==t.results[0].poster_path&&(s+=o.poster(t)),o.displayMovieInfo(s)}},error:function(e,t,s){console.log("failure"),$(o.sel).html("<p>Unable to communicate<br>with themoviedb.org</p>")}})}function parse_json(e){try{var t=$.parseJSON(e)}catch(t){throw"JSON parse error: "+e}return t}function Stars(e){this.sel=e,console.log("Stars constructor");for(var t=$(e+" table").find("tr"),s=1;s<t.length;s++)for(var o=$(t.get(s)),i=o.find('input[name="id"]').val(),a=o.find("img"),r=0;r<a.length;r++){var n=$(a.get(r));this.installListener(o,n,i,r+1)}}MovieInfo.prototype.info=function(e){var t='<li><a href=""><img src="images/info.png"></a><div>';return t+="<p>Title: "+e.results[0].title+"</p>",t+="<p>Release Date: "+e.results[0].release_date+"</p>",t+="<p>Vote average: "+e.results[0].vote_average+"</p>",t+="<p>Vote count: "+e.results[0].vote_count+"</p>",t+="</div></li>"},MovieInfo.prototype.plot=function(e){var t='<li><a href=""><img src="images/plot.png"></a><div>';return t+="<p>"+e.results[0].overview+"</p>",t+="</div></li>"},MovieInfo.prototype.poster=function(e){var t='<li><a href=""><img src="images/poster.png"></a><div>';return t+='<p class="poster"><img src="http://image.tmdb.org/t/p/w500'+e.results[0].poster_path+'">',t+="</div></li>"},MovieInfo.prototype.displayMovieInfo=function(e){var t="<ul>"+e+"</ul>";$(this.sel).html(t);var s=$("ul > li:first-child");s.children("div").show(),s.children("a").children().css("opacity","1"),$("ul > li > a").click(function(e){e.preventDefault(),console.log("tag clicked"),$(this).parent().siblings().children("div").fadeOut(750),$(this).parent().siblings().children("a").children().css("opacity","0.3"),$(this).parent().children("div").fadeIn(750),$(this).parent().children("a").children().css("opacity","1")})},Stars.prototype.installListener=function(e,t,s,o){var i=this;t.click(function(){$(i.sel+" table");$.ajax({url:"post/stars.php",data:{id:s,rating:o},method:"POST",success:function(t){var s=parse_json(t);s.ok?(i.update(e,o),i.message("<p>Successfully updated</p>"),i.updateTable(s.movies),i=new Stars(i.sel)):i.message("<p>Update failed</p>")},error:function(e,t,s){i.message("<p>Error: "+s+"</p>")}})})},Stars.prototype.update=function(e,t){for(var s=e.find("img"),o=0;o<s.length;o++){var i=$(s.get(o));o<t?i.attr("src","images/star-green.png"):i.attr("src","images/star-gray.png")}e.find("span.num").text(t+"/10")},Stars.prototype.message=function(e){var t=this;$(this.sel+" .message").show(),$(this.sel+" .message").html(e),window.setTimeout(function(){$(t.sel+" .message").fadeOut(1e3)},2e3)},Stars.prototype.updateTable=function(e){$(this.sel+" .table").hide(),$(this.sel+" .table").html(e),$(this.sel+" .table").fadeIn(1e3)};